name: infra-destroy
on: { workflow_dispatch: {} }

jobs:
  destroy:
    runs-on: ubuntu-latest
    env:
      GOOGLE_PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}
      GOOGLE_REGION: us-central1
      GOOGLE_ZONE: us-central1-a
    steps:
    - uses: actions/checkout@v4

    - uses: google-github-actions/auth@v2
      with:
        credentials_json: ${{ secrets.GCP_SA_KEY }}

    - uses: google-github-actions/setup-gcloud@v2
      with:
        project_id: ${{ secrets.GCP_PROJECT_ID }}
        version: '>= 488.0.0'

    - uses: hashicorp/setup-terraform@v3

    - name: Destroy
      run: bash scripts/infra_destroy.sh

